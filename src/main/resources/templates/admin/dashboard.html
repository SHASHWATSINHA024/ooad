<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head('Admin Dashboard')"></head>
<body>
    <header th:replace="fragments/layout :: header"></header>
    
    <div class="container-fluid mt-4">
        <div th:replace="fragments/layout :: alert"></div>
        
        <div class="row">
            <div class="col-md-2">
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active" id="overview-tab">Overview</a>
                    <a href="#" class="list-group-item list-group-item-action" id="users-tab">Users</a>
                    <a href="#" class="list-group-item list-group-item-action" id="books-tab">Books</a>
                    <a href="#" class="list-group-item list-group-item-action" id="transactions-tab">Transactions</a>
                    <a href="#" class="list-group-item list-group-item-action" id="reports-tab">Reports</a>
                    <a href="#" class="list-group-item list-group-item-action" id="settings-tab">Settings</a>
                </div>
            </div>
            
            <div class="col-md-10">
                <!-- Overview Tab -->
                <div id="overview-content">
                    <h1>Admin Dashboard</h1>
                    <p class="lead">Welcome, <span th:text="${user != null ? user.fullName : 'Admin'}">Admin</span>!</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-3">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Total Books</h5>
                                    <p class="card-text display-4" th:text="${stats != null ? stats.totalBooks : '0'}">450</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Total Users</h5>
                                    <p class="card-text display-4" th:text="${stats != null ? stats.totalUsers : '0'}">120</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-info mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Active Loans</h5>
                                    <p class="card-text display-4" th:text="${stats != null ? stats.activeLoans : '0'}">35</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-danger mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Overdue Books</h5>
                                    <p class="card-text display-4" th:text="${stats != null ? stats.overdueBooks : '0'}">7</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Recent Activities
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item" th:if="${recentActivities == null || recentActivities.empty}">
                                            No recent activities
                                        </li>
                                        <li class="list-group-item" th:each="activity : ${recentActivities ?: {}}">
                                            <div th:text="${activity.description}">Activity description</div>
                                            <small class="text-muted" th:text="${#temporals.format(activity.timestamp, 'dd MMM yyyy HH:mm')}">01 Apr 2024 14:30</small>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Popular Books
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item" th:if="${popularBooks == null || popularBooks.empty}">
                                            No data available
                                        </li>
                                        <li class="list-group-item" th:each="book : ${popularBooks ?: {}}">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <span th:text="${book.title}">Book Title</span>
                                                    <small class="text-muted d-block" th:text="${book.author}">Author</small>
                                                </div>
                                                <span class="badge bg-primary rounded-pill" th:text="${book.borrowCount} + ' borrows'">42 borrows</span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Tab (hidden by default) -->
                <div id="users-content" style="display: none;">
                    <h2>User Management</h2>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>All Users</span>
                            <a th:href="@{/admin/users/add}" class="btn btn-sm btn-primary">Add User</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Username</th>
                                            <th>Full Name</th>
                                            <th>Email</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${users == null || users.empty}">
                                            <td colspan="7" class="text-center">No users found</td>
                                        </tr>
                                        <tr th:each="user : ${users ?: {}}">
                                            <td th:text="${user.id}">1</td>
                                            <td th:text="${user.username}">username</td>
                                            <td th:text="${user.fullName}">Full Name</td>
                                            <td th:text="${user.email}">email@example.com</td>
                                            <td th:text="${user.role}">MEMBER</td>
                                            <td>
                                                <span class="badge bg-success" th:if="${user.active}">Active</span>
                                                <span class="badge bg-danger" th:unless="${user.active}">Inactive</span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a th:href="@{/admin/users/{id}/edit(id=${user.id})}" class="btn btn-outline-primary">Edit</a>
                                                    <a th:href="@{/admin/users/{id}/transactions(id=${user.id})}" class="btn btn-outline-info">Transactions</a>
                                                    <button th:if="${user.active}" class="btn btn-outline-danger" 
                                                            onclick="if(confirm('Are you sure you want to disable this user?')) 
                                                                        { document.getElementById('disable-form-' + [[${user.id}]]).submit(); }">
                                                        Disable
                                                    </button>
                                                    <button th:unless="${user.active}" class="btn btn-outline-success" 
                                                            onclick="if(confirm('Are you sure you want to enable this user?')) 
                                                            { document.getElementById('enable-form-' + [[${user.id}]]).submit(); }">
                                                        Enable
                                                    </button>
                                                    <form th:id="'disable-form-' + ${user.id}" th:action="@{/admin/users/{id}/disable(id=${user.id})}" method="post" style="display: none;"></form>
                                                    <form th:id="'enable-form-' + ${user.id}" th:action="@{/admin/users/{id}/enable(id=${user.id})}" method="post" style="display: none;"></form>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Books Tab (hidden by default) -->
                <div id="books-content" style="display: none;">
                    <h2>Book Management</h2>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>All Books</span>
                            <a th:href="@{/admin/books/add}" class="btn btn-sm btn-primary">Add Book</a>
                        </div>
                        <div class="card-body">
                            <!-- Book management content -->
                        </div>
                    </div>
                </div>
                
                <!-- Other tabs hidden by default -->
                <div id="transactions-content" style="display: none;">
                    <h2>Transaction Management</h2>
                    <!-- Transactions content -->
                </div>
                
                <div id="reports-content" style="display: none;">
                    <h2>Reports</h2>
                    <!-- Reports content -->
                </div>
                
                <div id="settings-content" style="display: none;">
                    <h2>System Settings</h2>
                    <!-- Settings content -->
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="fragments/layout :: footer"></footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching logic for admin dashboard
            const tabs = ['overview', 'users', 'books', 'transactions', 'reports', 'settings'];
            tabs.forEach(tab => {
                const tabElement = document.getElementById(tab + '-tab');
                if (tabElement) {
                    tabElement.addEventListener('click', function(e) {
                        e.preventDefault();
                        // Hide all content
                        tabs.forEach(t => {
                            const content = document.getElementById(t + '-content');
                            if (content) content.style.display = 'none';
                            const tabEl = document.getElementById(t + '-tab');
                            if (tabEl) tabEl.classList.remove('active');
                        });
                        // Show selected content
                        const content = document.getElementById(tab + '-content');
                        if (content) content.style.display = 'block';
                        this.classList.add('active');
                    });
                }
            });
        });
    </script>
</body>
</html>